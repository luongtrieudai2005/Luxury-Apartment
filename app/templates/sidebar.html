<div class="sidebar bg-white border-end d-flex flex-column" style="height: 100vh; position: sticky; top: 0;">
  <!-- User Info - Fixed top -->
  <div class="flex-shrink-0">
    <div class="text-center py-3 border-bottom">
      <img src="{{ url_for('static', filename='../../static/img/avt.png') }}" class="rounded-circle mb-2" width="60" height="60" alt="Avatar">
      <h6 class="mb-0">{{ username or 'Username' }}</h6>
      <small class="text-muted">{{ email or 'vidu@email.com' }}</small>
    </div>

    <!-- Search -->
    <div class="p-3">
      <div class="input-group input-group-sm">
        <span class="input-group-text bg-light border-0"><i class="bi bi-search"></i></span>
        <input type="text" class="form-control border-0" placeholder="Tìm kiếm mục">
      </div>
    </div>
  </div>

  <!-- Menu - Scrollable area -->
  <div class="flex-grow-1 overflow-auto" style="scrollbar-width: thin;">
    <ul class="nav flex-column px-2 pb-3">
      <li class="nav-item">
        <a class="nav-link active" href="{{ url_for('home') }}">
          <i class="bi bi-house-door"></i> Trang chủ
        </a>
      </li>

      <!-- Quản lý lưu trú -->
      <li class="nav-item">
        <a class="nav-link d-flex justify-content-between align-items-center" data-bs-toggle="collapse" href="#menuLuutru">
          <span><i class="bi bi-people"></i> Quản lý lưu trú</span>
          <i class="bi bi-chevron-down small"></i>
        </a>
        <div class="collapse ps-3" id="menuLuutru">
          <div class="nav flex-column">
            <a href="{{ url_for('register_stay') }}" class="nav-link py-1">Đăng ký lưu trú</a>
            <a href="{{ url_for('manage_houses') }}" class="nav-link py-1">Quản lý nhà</a>
            <a href="{{ url_for('bookings') }}" class="nav-link py-1">Đặt phòng</a>
            <a href="{{ url_for('contracts') }}" class="nav-link py-1">Hợp đồng thuê</a>
          </div>
        </div>
      </li>

      <!-- Quản lý dịch vụ -->
      <li class="nav-item">
        <a class="nav-link d-flex justify-content-between align-items-center" data-bs-toggle="collapse" href="#menuDichvu">
          <span><i class="bi bi-heart"></i> Quản lý dịch vụ</span>
          <i class="bi bi-chevron-down small"></i>
        </a>
        <div class="collapse ps-3" id="menuDichvu">
          <div class="nav flex-column">
            <a href="{{ url_for('utilities') }}" class="nav-link py-1">Chỉ số điện nước</a>
            <a href="{{ url_for('services') }}" class="nav-link py-1">Dịch vụ khác</a>
            <a href="{{ url_for('parking') }}" class="nav-link py-1">Phương tiện</a>
            <a href="{{ url_for('requests_feedback') }}" class="nav-link py-1">Yêu cầu/Phản ánh</a>
          </div>
        </div>
      </li>

      <!-- Báo cáo & Thống kê -->
      <li class="nav-item">
        <a class="nav-link d-flex justify-content-between align-items-center" data-bs-toggle="collapse" href="#menuBaocao">
          <span><i class="bi bi-bar-chart-line"></i> Báo cáo & Thống kê</span>
          <i class="bi bi-chevron-down small"></i>
        </a>
        <div class="collapse ps-3" id="menuBaocao">
          <div class="nav flex-column">
            <a href="{{ url_for('reports') }}" class="nav-link py-1">Dashboard báo cáo</a>
            <a href="{{ url_for('revenue_report') }}" class="nav-link py-1">Báo cáo doanh thu</a>
          </div>
        </div>
      </li>

      <!-- Công cụ tiện ích -->
      <li class="nav-item">
        <a class="nav-link d-flex justify-content-between align-items-center" data-bs-toggle="collapse" href="#menuTienich">
          <span><i class="bi bi-tools"></i> Công cụ tiện ích</span>
          <i class="bi bi-chevron-down small"></i>
        </a>
        <div class="collapse ps-3" id="menuTienich">
          <a href="#" class="nav-link py-1">Thống kê, in ấn, xuất file</a>
        </div>
      </li>

      <li class="nav-item">
        <a class="nav-link" href="{{ url_for('support') }}">
          <i class="bi bi-question-circle"></i> Cần hỗ trợ?
        </a>
      </li>
    </ul>
  </div>

  <!-- Logout - Fixed bottom -->
  <div class="flex-shrink-0 p-3 border-top">
    <a href="{{ url_for('logout') }}" class="btn btn-light w-100">
      <i class="bi bi-box-arrow-right"></i> Đăng xuất
    </a>
  </div>
</div>

<!-- Script cho Dark Mode -->
<script>
  // Load dark mode setting khi trang load
  document.addEventListener('DOMContentLoaded', function() {
    const darkMode = localStorage.getItem('darkMode') === 'true';
    if (darkMode) {
      document.body.classList.add('dark-mode');
      updateDarkModeIcon(true);
    }
  });

  function toggleDarkMode() {
    const isDark = document.body.classList.toggle('dark-mode');
    localStorage.setItem('darkMode', isDark);
    updateDarkModeIcon(isDark);
  }

  function updateDarkModeIcon(isDark) {
    const icon = document.querySelector('#darkModeToggle i');
    if (icon) {
      icon.className = isDark ? 'bi bi-sun-fill' : 'bi bi-moon-fill';
    }
  }
</script>

<style>
/* Custom scrollbar cho sidebar */
.sidebar .overflow-auto::-webkit-scrollbar {
  width: 6px;
}

.sidebar .overflow-auto::-webkit-scrollbar-track {
  background: #f1f1f1;
}

.sidebar .overflow-auto::-webkit-scrollbar-thumb {
  background: #888;
  border-radius: 3px;
}

.sidebar .overflow-auto::-webkit-scrollbar-thumb:hover {
  background: #555;
}

/* Đảm bảo sidebar không bị overflow */
.sidebar {
  overflow: hidden;
}

/* Animation cho collapse menu */
.collapse {
  transition: all 0.3s ease-in-out;
}

/* Highlight active link */
.nav-link.active {
  background-color: #e7f3ff;
  color: #0d6efd;
  border-radius: 5px;
}

.nav-link:hover {
  background-color: #f8f9fa;
  border-radius: 5px;
}

/* ========== DARK MODE STYLES ========== */
body {
  transition: background-color 0.3s ease, color 0.3s ease;
}

/* Dark mode cho body và containers */
.dark-mode {
  background-color: #1a1a1a;
  color: #e0e0e0;
}

.dark-mode .bg-light {
  background-color: #2d2d2d !important;
  color: #e0e0e0;
}

.dark-mode .bg-white {
  background-color: #2d2d2d !important;
  color: #e0e0e0;
}

.dark-mode .text-muted {
  color: #b0b0b0 !important;
}

/* Dark mode cho sidebar */
.dark-mode .sidebar {
  background-color: #2d2d2d !important;
  border-color: #404040 !important;
}

.dark-mode .sidebar .border-bottom,
.dark-mode .sidebar .border-top {
  border-color: #404040 !important;
}

/* Dark mode cho navigation links */
.dark-mode .nav-link {
  color: #e0e0e0;
}

.dark-mode .nav-link:hover {
  background-color: #3d3d3d !important;
}

.dark-mode .nav-link.active {
  background-color: #1e3a5f !important;
  color: #4da6ff;
}

/* Dark mode cho navbar */
.dark-mode .navbar {
  background-color: #2d2d2d !important;
  border-color: #404040 !important;
}

.dark-mode .navbar-light {
  background-color: #2d2d2d !important;
}

/* Dark mode cho cards */
.dark-mode .card {
  background-color: #2d2d2d;
  border-color: #404040;
  color: #e0e0e0;
}

.dark-mode .card-header {
  background-color: #242424 !important;
  border-color: #404040;
  color: #e0e0e0;
}

/* Dark mode cho tables */
.dark-mode .table {
  color: #e0e0e0;
}

.dark-mode .table-light {
  background-color: #3d3d3d !important;
  color: #e0e0e0;
}

.dark-mode .table-hover tbody tr:hover {
  background-color: #3d3d3d;
}

.dark-mode .table-bordered {
  border-color: #404040;
}

.dark-mode .table-bordered td,
.dark-mode .table-bordered th {
  border-color: #404040;
}

/* Dark mode cho forms */
.dark-mode .form-control,
.dark-mode .form-select {
  background-color: #3d3d3d;
  border-color: #404040;
  color: #e0e0e0;
}

.dark-mode .form-control:focus,
.dark-mode .form-select:focus {
  background-color: #3d3d3d;
  border-color: #4da6ff;
  color: #e0e0e0;
}

.dark-mode .input-group-text {
  background-color: #3d3d3d !important;
  border-color: #404040;
  color: #e0e0e0;
}

/* Dark mode cho buttons */
.dark-mode .btn-light {
  background-color: #3d3d3d;
  border-color: #404040;
  color: #e0e0e0;
}

.dark-mode .btn-light:hover {
  background-color: #4d4d4d;
  border-color: #505050;
  color: #e0e0e0;
}

.dark-mode .btn-outline-secondary {
  color: #b0b0b0;
  border-color: #404040;
}

.dark-mode .btn-outline-secondary:hover {
  background-color: #3d3d3d;
  border-color: #404040;
  color: #e0e0e0;
}

/* Dark mode cho modals */
.dark-mode .modal-content {
  background-color: #2d2d2d;
  color: #e0e0e0;
}

.dark-mode .modal-header,
.dark-mode .modal-footer {
  border-color: #404040;
}

/* Dark mode cho alerts */
.dark-mode .alert {
  border-color: #404040;
}

/* Dark mode cho scrollbar */
.dark-mode .sidebar .overflow-auto::-webkit-scrollbar-track {
  background: #2d2d2d;
}

.dark-mode .sidebar .overflow-auto::-webkit-scrollbar-thumb {
  background: #555;
}

.dark-mode .sidebar .overflow-auto::-webkit-scrollbar-thumb:hover {
  background: #777;
}

/* Dark mode cho badges */
.dark-mode .badge.bg-warning {
  background-color: #d39e00 !important;
  color: #000;
}

.dark-mode .badge.bg-light {
  background-color: #3d3d3d !important;
  color: #e0e0e0;
}

/* Dark mode cho dropdowns */
.dark-mode .dropdown-menu {
  background-color: #2d2d2d;
  border-color: #404040;
}

.dark-mode .dropdown-item {
  color: #e0e0e0;
}

.dark-mode .dropdown-item:hover {
  background-color: #3d3d3d;
  color: #e0e0e0;
}
</style>